# ============================================
# Dockerfile for Render Deployment
# (WhatsApp MCP Server - Python)
# ============================================

# TODO: Use Python 3.11 slim image for smaller size
# FROM python:3.11-slim

# ============================================
# System Setup
# ============================================
# TODO: Set working directory to /app
# TODO: Install system dependencies if needed (curl, etc.)
# TODO: Create non-root user for security

# ============================================
# Python Dependencies
# ============================================
# TODO: Copy requirements.txt first (for Docker layer caching)
# TODO: Upgrade pip: pip install --upgrade pip
# TODO: Install Python packages: pip install --no-cache-dir -r requirements.txt
# TODO: This installs: mcp, uvicorn, starlette, claude-agent-sdk, etc.

# ============================================
# Copy Application Code
# ============================================
# TODO: Copy all Python source code
# TODO: Copy src/python/ directory
# TODO: Copy .env file (if needed, but prefer env vars from Render dashboard)

# ============================================
# Environment Variables (Set in Render Dashboard)
# ============================================
# - ANTHROPIC_API_KEY
# - WHATSAPP_ACCESS_TOKEN
# - WHATSAPP_PHONE_NUMBER_ID
# - PORT (automatically set by Render)
# - MCP_TRANSPORT=sse

# ============================================
# Expose Port
# ============================================
# TODO: Expose the PORT that Render provides (usually 10000)
# EXPOSE 10000

# ============================================
# Health Check (Optional but Recommended)
# ============================================
# TODO: Add health check endpoint in your MCP server
# HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
#   CMD curl -f http://localhost:${PORT}/health || exit 1

# ============================================
# Start MCP Server
# ============================================
# TODO: Switch to non-root user
# TODO: CMD to start server with uvicorn and SSE transport
# CMD ["python", "src/python/mcp/server.py", "--transport", "sse", "--port", "${PORT}"]
#
# Alternative using uvicorn directly:
# CMD ["uvicorn", "src.python.mcp.server:app", "--host", "0.0.0.0", "--port", "${PORT}"]

# ============================================
# Notes:
# ============================================
# - Render automatically sets $PORT environment variable
# - MCP uses SSE (Server-Sent Events) transport for communication
# - This server exposes WhatsApp tools (send_message, get_conversation)
# - Agents running on Vercel will call this MCP server
# - Make sure to configure Render's environment variables before deploying
